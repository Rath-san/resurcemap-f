var K=Object.defineProperty,Y=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var x=(e,r,a)=>r in e?K(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,M=(e,r)=>{for(var a in r||(r={}))X.call(r,a)&&x(e,a,r[a]);if(R)for(var a of R(r))H.call(r,a)&&x(e,a,r[a]);return e},O=(e,r)=>Y(e,Q(r));import{r as _,o as E,L as u,a as z,P as J,b as ee,t as re,v as te,d as v,c as g,e as m,f as j,g as ne,h as Z,i as f,w as N,j as F,F as T,n as L,T as ae,k as oe,l as se,m as $,p as ie,q as b,s as ce}from"./vendor.d3a8b5bf.js";const le=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&l(n)}).observe(document,{childList:!0,subtree:!0});function a(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(t){if(t.ep)return;t.ep=!0;const s=a(t);fetch(t.href,s)}};le();const ue={TILES:"tiles",MARKERS:"markers"},de=(e,r)=>`https://render.guildwars2.com/file/${e}/${r}.png`,me={mining:{signature:"A89EB66C39C7C006A4A6CBEDA28061F16847E9BC",id:"157334"},logging:{signature:"FC01BB452D5327A0E5B2E4A3F5EFDF03F8264A7B",id:"157333"},harvesting:{signature:"995534EBE5D26804AE605E205E50539821C0CBCB",id:"157332"}},A=Object.fromEntries(Object.entries(me).map(([e,r])=>[e,de(r.signature,r.id)])),pe="http://localhost:4000/public/1/1/{z}/{x}/{y}.jpg",U=(e,r)=>r.unproject(e,r.getMaxZoom()),ge=e=>u.map(e,{minZoom:0,maxZoom:7,crs:u.CRS.Simple,fadeAnimation:!1,markerZoomAnimation:!1}).setView([0,0],0),p=_(null),S=_(null),I=e=>{const r=t=>{!p.value||(t==null?void 0:t.length)&&t.forEach(s=>{p.value.on(s.name,s.cb)})},a=t=>{const s=[81920,114688],n=U([0,0],t),o=U(s,t),i=new u.LatLngBounds(n,o);console.log(i),t.setMaxBounds(i),u.TileLayer.WikiTileLayer=u.TileLayer.extend({getTileUrl:function(c){var d="World_map_tile_C"+this.options.continent+"_F"+this.options.floor+"_Z"+c.z+"_X"+c.x+"_Y"+c.y+".jpg";return console.log(d),"https://wiki.guildwars2.com/images/"+d}}),u.tileLayer.wikiTileLayer=function(c,d){return new u.TileLayer.WikiTileLayer(c,d)},u.GridLayer.GridDebug=u.GridLayer.extend({createTile:function(c){const d=document.createElement("div");return d.style.outline="1px solid green",d.style.fontWeight="bold",d.style.fontSize="12px",d.innerHTML="&nbsp;Tile: Z="+c.z+", X="+c.x+", Y="+c.y+"<br>&nbsp;["+c.x*256*Math.pow(2,t.getMaxZoom()-c.z)+", "+c.y*256*Math.pow(2,t.getMaxZoom()-c.z)+"]",c.z<this.options.mapMinNativeZoom?d.style.color="red":d.style.color="white",d}}),u.gridLayer.gridDebug=function(c){return new u.GridLayer.GridDebug(c)},u.tileLayer(pe,{accessToken:ue.TILES,minNativeZoom:1,bounds:i,noWrap:!0}).addTo(t),S.value=u.layerGroup([],{}).addTo(t),t.addLayer(u.gridLayer.gridDebug({mapMinNativeZoom:1,bounds:i}))},l=()=>S.value.getLayers();return E(()=>{p.value||!e||(p.value=ge(e),a(p.value))}),z(()=>{!p.value||(p.value.off(),p.value.remove(),p.value=null)}),{mapContainer:p,markerLayer:S,getMarkers:l,registerMapEvents:r}};var _e=e=>{const r=new J(e,{auto_compaction:!0}),a=async(n,o)=>{try{const i=await r.get(n),c=await r.put({_id:n,_rev:i._rev,marker:M(M({},i.marker),o)});return r.get(c.id)}catch(i){if(i.status===404)try{const c=await r.put({_id:n,marker:o});return r.get(c.id)}catch(c){console.error(c)}}},l=async n=>r.get(n);return{createOrUpdate:a,get:async(n=[])=>{try{const o=await r.allDocs({include_docs:!0});return o.rows.length?o.rows.map(i=>M({id:i.id},i.doc.marker)):[]}catch(o){return console.log(o),[]}},getById:l,remove:async n=>{try{const o=await l(n);o&&r.remove(o)}catch(o){return console.log(o),o}}}};const D=_e("markers"),{markerLayer:P}=I(),fe=[{name:"click",cb:e=>{e.originalEvent.stopPropagation()}},{name:"move",cb:e=>{}}],ke=e=>{const r=32;return u.divIcon({html:`<div data-uuid=${e} class="icon"></div>`,iconSize:[r,r],iconAnchor:[r,r]})},y=ee({markers:[],markerDefault:"mining"}),ve=e=>{y.markerDefault=e},ye=async()=>{try{const e=await D.get();e.length&&e.forEach(r=>{B(r)})}catch(e){console.log(e)}};ye();const B=({id:e,latlng:{lat:r,lng:a},name:l,title:t,nodeType:s,events:n})=>{const o=u.marker([r,a],{draggable:!0,title:t,icon:ke(e)});return o.id=e,o.name=l,o.nodeType=s,(n==null?void 0:n.length)&&n.forEach(i=>{o.on(i.name,i.cb)}),$e(o),V(),o},G=async(e,r)=>{await D.createOrUpdate(e,r)},he=async e=>{const r=await B({id:te(),latlng:e.latlng,name:y.markerDefault,nodeType:y.markerDefault,events:fe,title:y.markerDefault});await G(r.id,{latlng:e.latlng,name:r.name,nodeType:r.nodeType,title:r.options.title})},Me=async e=>(e.remove(),await D.remove(e.id),{}),$e=e=>{P.value.addLayer(e)},V=()=>{y.markers=[...P.value.getLayers()]},w=()=>O(M({},re(y)),{createMarker:B,addMarker:he,updateMarkers:V,saveMarker:G,removeMarkerEntry:Me,setActiveNodeType:ve});var h=(e,r)=>{const a=e.__vccOpts||e;for(const[l,t]of r)a[l]=t;return a};const Ce=v({name:"MapContainer",setup(e){const{registerMapEvents:r}=I("map"),{addMarker:a}=w();return E(()=>{r([{name:"click",cb:a}])}),{}}}),Ee={id:"map"};function Le(e,r,a,l,t,s){return m(),g("div",Ee)}var be=h(Ce,[["render",Le]]);const we=v({name:"MarkerItem",components:{},props:{marker:{type:Object,default:()=>{},required:!1}},setup(e){const{markerDefault:r,saveMarker:a,removeMarkerEntry:l}=w(),t=j(()=>`[data-uuid="${e.marker.id}"]`),s=Object.entries(A),n=_(!1),o=()=>{e.marker.on("dragstart",()=>{console.log("dragqueen"),n.value=!0}),e.marker.on("dragend",async()=>{console.log(e.marker);const{lat:k,lng:q}=e.marker.getLatLng();await a(e.marker.id,{latlng:{lat:k,lng:q}})})};E(()=>{o()}),z(()=>{});const i=_(!1),c=()=>{n.value||(i.value=!i.value),n.value=!1},d=_(null);ne(d,()=>i.value=!1);const C=_(e.marker.nodeType),W=j(()=>A[C.value]);return{markerIdQueryString:t,markerIcons:s,currentNodeName:C,currentNodeIcon:W,isCurrentNode:k=>C.value===k,changeCurrentNode:k=>{console.log(e.marker),C.value=k,a(e.marker.id,{nodeType:k})},active:i,toggleActive:c,target:d,dragged:n,handleRemoveMarker:()=>{l(e.marker)}}}}),Ne={class:L(["marker-icon","marker__main"])},Te=["src","alt"],Ae={class:"marker__options"},Se=["onClick"],Ie=["src","alt"],De=f("span",null,"x",-1),Be=[De];function Re(e,r,a,l,t,s){return m(),Z(ae,{to:e.markerIdQueryString},[f("div",{ref:"target",class:L(["marker",{"marker--active":e.active,"marker--dragged":e.dragged}])},[f("div",Ne,[f("img",{src:e.currentNodeIcon,alt:e.currentNodeName,onClick:r[0]||(r[0]=N((...n)=>e.toggleActive&&e.toggleActive(...n),["stop"]))},null,8,Te)]),f("div",Ae,[(m(!0),g(T,null,F(e.markerIcons,(n,o)=>(m(),g("div",{class:L(["marker-icon","marker__option",{"marker__option--current":e.isCurrentNode(n[0])}]),key:o,onClick:N(i=>e.changeCurrentNode(n[0]),["stop"]),style:oe(`--r-index: ${o}`)},[f("img",{src:n[1],alt:n[0]},null,8,Ie)],14,Se))),128)),f("div",{class:L(["marker-icon","marker__option","marker__option--delete"]),onClick:r[1]||(r[1]=N((...n)=>e.handleRemoveMarker&&e.handleRemoveMarker(...n),["stop"])),style:"--r-index: 5"},Be)])],2)],8,["to"])}var xe=h(we,[["render",Re]]);const Oe=v({name:"MarkersContainer",components:{MarkerItem:xe},setup(e){const{mapContainer:r,registerMapEvents:a}=I(),{markers:l}=w(),t=_(null);return E(()=>{t.value=document.querySelector(".leaflet-marker-pane")}),se(r,(s,n)=>{a([{name:"move",cb:o=>{}},{name:"viewreset",cb:o=>{console.log(o)}}])}),{markers:l,markerPane:t}}}),ze={key:0,class:"markers"};function je(e,r,a,l,t,s){const n=$("MarkerItem");return e.markerPane?(m(),g("div",ze,[(m(!0),g(T,null,F(e.markers,(o,i)=>(m(),Z(n,{key:o.id,marker:o},null,8,["marker"]))),128))])):ie("",!0)}var Ze=h(Oe,[["render",je]]);const Fe=v({name:"NodeSelector",components:{},props:{},setup(e){const{markerDefault:r}=w(),a=Object.entries(A);return{markerDefault:r,markerIcons:a,isCurrentNode:s=>r.value===s,handleChangeCurrent:s=>{r.value=s}}}}),Ue={class:"node-selector"};function Pe(e,r,a,l,t,s){return m(),g("div",Ue)}var Ge=h(Fe,[["render",Pe]]);const Ve=v({name:"UserInterface",components:{NodeSelector:Ge},props:{},setup(e){return{}}}),We={class:"interface"};function qe(e,r,a,l,t,s){const n=$("NodeSelector");return m(),g("div",We,[b(n)])}var Ke=h(Ve,[["render",qe]]);const Ye=v({name:"App",components:{MapContainer:be,MarkersContainer:Ze,UserInterface:Ke},setup(e){return{}}});function Qe(e,r,a,l,t,s){const n=$("MapContainer"),o=$("MarkersContainer"),i=$("UserInterface");return m(),g(T,null,[b(n),b(o),b(i)],64)}var Xe=h(Ye,[["render",Qe]]);ce(Xe).mount("#app");
